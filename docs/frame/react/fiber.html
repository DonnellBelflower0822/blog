<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>fiber | 前端博客</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/blog/assets/css/0.styles.1004bf6e.css" as="style"><link rel="preload" href="/blog/assets/js/app.2a6cfc5b.js" as="script"><link rel="preload" href="/blog/assets/js/2.a7269d81.js" as="script"><link rel="preload" href="/blog/assets/js/10.8ca8d11a.js" as="script"><link rel="prefetch" href="/blog/assets/js/11.5abfa0f3.js"><link rel="prefetch" href="/blog/assets/js/12.bbea033b.js"><link rel="prefetch" href="/blog/assets/js/13.b928d2ff.js"><link rel="prefetch" href="/blog/assets/js/14.37083734.js"><link rel="prefetch" href="/blog/assets/js/15.eedc8d9d.js"><link rel="prefetch" href="/blog/assets/js/16.81f69201.js"><link rel="prefetch" href="/blog/assets/js/17.8828aa94.js"><link rel="prefetch" href="/blog/assets/js/18.7ab03926.js"><link rel="prefetch" href="/blog/assets/js/19.e7c8b904.js"><link rel="prefetch" href="/blog/assets/js/20.2af66c37.js"><link rel="prefetch" href="/blog/assets/js/21.38654395.js"><link rel="prefetch" href="/blog/assets/js/22.a1ccc9a0.js"><link rel="prefetch" href="/blog/assets/js/23.fd03343b.js"><link rel="prefetch" href="/blog/assets/js/24.39b0bbae.js"><link rel="prefetch" href="/blog/assets/js/25.ec20b6f9.js"><link rel="prefetch" href="/blog/assets/js/26.67e0d150.js"><link rel="prefetch" href="/blog/assets/js/27.81bd6dbe.js"><link rel="prefetch" href="/blog/assets/js/28.be2d4523.js"><link rel="prefetch" href="/blog/assets/js/29.e3c2f986.js"><link rel="prefetch" href="/blog/assets/js/3.2c8c654e.js"><link rel="prefetch" href="/blog/assets/js/30.0de85ee2.js"><link rel="prefetch" href="/blog/assets/js/31.89645e1f.js"><link rel="prefetch" href="/blog/assets/js/32.e83bce2e.js"><link rel="prefetch" href="/blog/assets/js/33.8fb12b13.js"><link rel="prefetch" href="/blog/assets/js/34.162f44a4.js"><link rel="prefetch" href="/blog/assets/js/35.fae13b71.js"><link rel="prefetch" href="/blog/assets/js/36.8cbb0874.js"><link rel="prefetch" href="/blog/assets/js/37.33855e9b.js"><link rel="prefetch" href="/blog/assets/js/38.8cf5a3a9.js"><link rel="prefetch" href="/blog/assets/js/39.1f20b38b.js"><link rel="prefetch" href="/blog/assets/js/4.0dc3f3e5.js"><link rel="prefetch" href="/blog/assets/js/40.8074786e.js"><link rel="prefetch" href="/blog/assets/js/41.8be588ea.js"><link rel="prefetch" href="/blog/assets/js/42.bb2a47da.js"><link rel="prefetch" href="/blog/assets/js/43.7b28097b.js"><link rel="prefetch" href="/blog/assets/js/44.fe33d253.js"><link rel="prefetch" href="/blog/assets/js/45.5e0ff360.js"><link rel="prefetch" href="/blog/assets/js/46.58badb4f.js"><link rel="prefetch" href="/blog/assets/js/47.8448c0dd.js"><link rel="prefetch" href="/blog/assets/js/48.10654cd8.js"><link rel="prefetch" href="/blog/assets/js/49.4b26af0d.js"><link rel="prefetch" href="/blog/assets/js/5.0923dd2e.js"><link rel="prefetch" href="/blog/assets/js/50.ccc5d893.js"><link rel="prefetch" href="/blog/assets/js/51.b155bf38.js"><link rel="prefetch" href="/blog/assets/js/6.66ffa1e3.js"><link rel="prefetch" href="/blog/assets/js/7.16b5504f.js"><link rel="prefetch" href="/blog/assets/js/8.f5bb2c72.js"><link rel="prefetch" href="/blog/assets/js/9.cfa5b6f2.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.1004bf6e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">前端博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/basic/" class="nav-link">
  基础篇
</a></div><div class="nav-item"><a href="/blog/frame/" class="nav-link router-link-active">
  框架篇
</a></div><div class="nav-item"><a href="/blog/browser/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/blog/engine/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/blog/http/" class="nav-link">
  http
</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/blog/resume.html" class="nav-link">
  简历
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/basic/" class="nav-link">
  基础篇
</a></div><div class="nav-item"><a href="/blog/frame/" class="nav-link router-link-active">
  框架篇
</a></div><div class="nav-item"><a href="/blog/browser/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/blog/engine/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/blog/http/" class="nav-link">
  http
</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/blog/resume.html" class="nav-link">
  简历
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/blog/frame/react/" class="sidebar-heading clickable router-link-active open"><span>React</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/frame/react/" aria-current="page" class="sidebar-link">React概念</a></li><li><a href="/blog/frame/react/my-react.html" class="sidebar-link">手写react</a></li><li><a href="/blog/frame/react/hook.html" class="sidebar-link">Hook</a></li><li><a href="/blog/frame/react/my-redux.html" class="sidebar-link">react-redux</a></li><li><a href="/blog/frame/react/optimize.html" class="sidebar-link">性能优化</a></li><li><a href="/blog/frame/react/fiber.html" aria-current="page" class="active sidebar-link">fiber</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#概念" class="sidebar-link">概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#目的" class="sidebar-link">目的</a></li><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#在-fiber-出现之前-react-存在什么问题" class="sidebar-link">在 Fiber 出现之前 React 存在什么问题</a></li><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#fiber-如何解决性能问题" class="sidebar-link">Fiber 如何解决性能问题</a></li><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#什么是-fiber" class="sidebar-link">什么是 Fiber</a></li><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#fiber-的工作方式" class="sidebar-link">Fiber 的工作方式</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#架构" class="sidebar-link">架构</a></li><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#requestidlecallback" class="sidebar-link">requestIdleCallback</a></li><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#问题" class="sidebar-link">问题</a></li><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#方案" class="sidebar-link">方案</a></li><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#思路" class="sidebar-link">思路</a></li><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#步骤" class="sidebar-link">步骤</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#挂载" class="sidebar-link">挂载</a></li><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#更新" class="sidebar-link">更新</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/frame/react/fiber.html#实现" class="sidebar-link">实现</a></li></ul></li><li><a href="/blog/frame/react/immutable.html" class="sidebar-link">数据不可变</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/frame/vue/" class="sidebar-heading clickable"><span>Vue</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="fiber"><a href="#fiber" class="header-anchor">#</a> fiber</h1> <h2 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h2> <h3 id="目的"><a href="#目的" class="header-anchor">#</a> 目的</h3> <blockquote><p>为了提高 React 渲染页面的效率，减少页面卡顿，提升用户体验。</p></blockquote> <h3 id="在-fiber-出现之前-react-存在什么问题"><a href="#在-fiber-出现之前-react-存在什么问题" class="header-anchor">#</a> 在 Fiber 出现之前 React 存在什么问题</h3> <blockquote><p>核心就是递归比对的过程长期占用主线程产生了性能问题。</p></blockquote> <ul><li>在 Virtual DOM 比对的过程中 React 使用了递归，递归调用的过程不能被终止，</li> <li>如果 Virtual DOM 的层级比较深，递归比对的过程就会长期占用主线程，</li> <li>而 JavaScript 又是单线程，不能同时执行多个任务，其他任务只能等待执行，而且 JavaScript 的执行和 UI 的渲染又是互斥的，</li> <li>此时用户要么看到的就是空白界面，要么就是有界面但是不能响应用户操作，处于卡顿状态，用户体验差。</li></ul> <h3 id="fiber-如何解决性能问题"><a href="#fiber-如何解决性能问题" class="header-anchor">#</a> Fiber 如何解决性能问题</h3> <ul><li>在 Fiber 架构中 React 放弃了递归调用，采用循环来模拟递归，因为循环可以随时被中断。</li> <li>React 利用<code>浏览器空闲时间</code>执行比对任务， 解决了 React 执行比对任务长期占用主线程的问题。</li> <li>React 在执行完一个任务单元后，查看是否有其他的<code>高优先级任务</code>，如果有，放弃占用主线程，先执行优先级高的任务。</li></ul> <h3 id="什么是-fiber"><a href="#什么是-fiber" class="header-anchor">#</a> 什么是 Fiber</h3> <ul><li>Fiber 是一个执行单元
<ul><li>在 React 15 中，将 VirtualDOM 树整体看成一个任务进行递归处理，任务整体庞大执行耗时且不能中断。</li> <li>在 React 16 中，将整个任务拆分成了一个一个小的任务进行处理，每一个小的任务指的就是一个 Fiber 节点的构建。</li> <li>任务会在浏览器的空闲时间被执行，每个单元执行完成后，React 都会检查是否还有空余时间，如果有就交还主线程的控制权。</li></ul></li></ul> <img src="/blog/assets/img/run-fiber.779094f2.png"> <ul><li>Fiber 是一种数据结构
<ul><li>Fiber 是一种数据结构，支撑 Fiber 构建任务的运转。</li> <li>React 通过链表结构找到下一个要执行的任务单元。</li> <li>要构建链表结构，需要知道每一个节点的父级节点是谁，要知道他的子级节点是谁，要知道他的下一个兄弟节点是谁。</li> <li>Fiber 其实就是 JavaScript 对象，在这个对象中有 child 属性表示节点的子节点，有 sibling 属性表示节点的下一个兄弟节点，有 return 属性表示节点的父级节点。</li></ul></li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> Fiber <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 组件类型 div、span、组件构造函数</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
  <span class="token comment">// DOM 对象, 函数组件, 类组件实例</span>
  stateNode<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>  
  <span class="token comment">// 指向自己的父级 Fiber 对象</span>
  <span class="token keyword">return</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token comment">// 指向自己的第一个子级 Fiber 对象</span>
  child<span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token comment">// 指向自己的下一个兄弟 iber 对象</span>
  sibling<span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><img src="/blog/assets/img/fiber.e209d953.png"> <h3 id="fiber-的工作方式"><a href="#fiber-的工作方式" class="header-anchor">#</a> Fiber 的工作方式</h3> <ul><li>fiber 的工作分为两个阶段：render 阶段和 commit 阶段。
<ul><li>render 阶段：构建 Fiber 对象，构建链表，在链表中标记要执行的 DOM 操作 ，可中断。
<ul><li>先从上向下走，构建节点对应的 Fiber 对象，然后再从下向上走，构建 Fiber 对象及链表。</li></ul></li> <li>commit 阶段：根据构建好的链表进行 DOM 操作，不可中断。</li></ul></li></ul> <h2 id="架构"><a href="#架构" class="header-anchor">#</a> 架构</h2> <ul><li>Scheduler（调度器）—— 调度任务的优先级，高优任务优先进入Reconciler</li> <li>Reconciler（协调器）—— 负责找出变化的组件</li> <li>Renderer（渲染器）—— 负责将变化的组件渲染到页面上</li></ul> <h2 id="requestidlecallback"><a href="#requestidlecallback" class="header-anchor">#</a> requestIdleCallback</h2> <blockquote><p>利用浏览器的空余时间执行任务，如果有更高优先级的任务要执行时，当前执行的任务可以被终止，优先执行高级别任务。</p></blockquote> <blockquote><p>页面是一帧一帧绘制出来的，当每秒绘制的帧数达到 60 时，页面是流畅的，小于这个值时， 用户会感觉到卡顿</p></blockquote> <blockquote><p>1s 60帧，每一帧分到的时间是 1000/60 ≈ 16 ms，如果每一帧执行的时间小于16ms，就说明浏览器有空余时间</p></blockquote> <p>如果任务在剩余的时间内没有完成则会停止任务执行，继续优先执行主任务，也就是说 requestIdleCallback 总是利用浏览器的空余时间执行任务</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token parameter">idleDeadline</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当剩余时间大于1时才执行</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> idleDeadline<span class="token punctuation">.</span><span class="token function">timeRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
    value <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.4</span> <span class="token operator">?</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    count<span class="token operator">--</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 再次去申请浏览器空余时间执行</span>
  <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>calc<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

btn1<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 申请浏览器空余时间执行calc计算方法</span>
  <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>calc<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h2> <blockquote><p>对更新 VirtualDOM 递归无法中断，执行重任务耗时长。 JavaScript 又是单线程，无法同时执行其他任务，导致任务延迟页面卡顿，用户体验差。</p></blockquote> <h2 id="方案"><a href="#方案" class="header-anchor">#</a> 方案</h2> <ol><li>利用浏览器空闲时间执行任务，拒绝长时间占用主线程</li> <li>放弃递归只采用循环，因为循环可以被中断</li> <li>任务拆分，将任务拆分成一个个的小任务</li></ol> <h2 id="思路"><a href="#思路" class="header-anchor">#</a> 思路</h2> <p>在 Fiber 方案中，为了实现任务的终止再继续，DOM比对算法被分成了两部分：</p> <ol><li>构建 Fiber (Reconciler)       (可中断)</li> <li>提交 Commit (Renderer)  (不可中断)</li></ol> <p>DOM 初始渲染: virtualDOM -&gt; Fiber -&gt; Fiber[] -&gt; DOM</p> <p>DOM 更新操作: newFiber vs oldFiber -&gt; Fiber[] -&gt; DOM</p> <p>Fiber 对象</p> <div class="language- extra-class"><pre class="language-text"><code>{
  type         节点类型 (元素, 文本, 组件)
  props        节点属性
  stateNode    节点 DOM 对象 | 组件实例对象 | 函数组件
  tag          节点标记 (hostRoot || hostComponent || classComponent || functionComponent)
  effects      数组, 存储需要更改的 fiber 对象
  effectTag    当前 Fiber 要被执行的操作 (新增, 删除, 修改)

  return       当前 Fiber 的父级 Fiber
  child        当前 Fiber 的大儿子 Fiber
  sibling      当前 Fiber 的下一个兄弟 Fiber
  alternate    Fiber 备份 fiber 比对时使用
}
</code></pre></div><h2 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h2> <h3 id="挂载"><a href="#挂载" class="header-anchor">#</a> 挂载</h3> <ul><li>调用render,往任务队列添加任务,</li> <li>将虚拟dom构建成fiber(render)(申请浏览器空闲时执行任务)(异步可中断)
<ul><li>处理children
<ul><li>为每个child构建fiber
<ul><li>记录return(父fiber),child(大儿子fiber),slibing(兄弟fiber)</li></ul></li> <li>标记effectTag</li></ul></li> <li>如果有child(大儿子): 处理child</li> <li>如果有slibing(兄弟节点): 处理slibing</li> <li>都没有处理父亲的兄弟节点(slibing)</li> <li>记录当前的effects, 从里到外的顺序</li></ul></li> <li>commitAllWork(将更新effects插入dom上)(commit)(同步)
<ul><li>根据遍历effects执行更新,删除,挂载等操作</li></ul></li></ul> <h3 id="更新"><a href="#更新" class="header-anchor">#</a> 更新</h3> <ul><li>往任务队列添加组件更新任务</li> <li>从rootFiber开始</li> <li>将虚拟dom构建成fiber(此时就有alternate)
<ul><li>可以比较虚拟dom和旧的fiber的差异</li> <li>给fiber打上不同的effectTag</li></ul></li> <li>commitAllWork(renderer)(同步)</li></ul> <h2 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> arrified<span class="token punctuation">,</span> createStateNode<span class="token punctuation">,</span> getRootFiber<span class="token punctuation">,</span> getTag <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../utils'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> updateNodeElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../utils/dom'</span>
<span class="token keyword">import</span> taskQueue <span class="token keyword">from</span> <span class="token string">'../utils/taskQueue'</span>

<span class="token comment">/**
 * 1. 往任务队列添加任务
 * 2. 在浏览器空闲时执行任务
 * 
 * 任务
 * 通过vdom构建fiber对象
 */</span>

<span class="token keyword">let</span> subTask <span class="token operator">=</span> <span class="token keyword">null</span>

<span class="token comment">// 获取第一个任务</span>
<span class="token keyword">function</span> <span class="token function">getFirstTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> task <span class="token operator">=</span> taskQueue<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 组件状态更新</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span>from <span class="token operator">===</span> <span class="token string">'class_component'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 通过类组件实例找到根fiber</span>
    <span class="token keyword">const</span> rootFiber <span class="token operator">=</span> <span class="token function">getRootFiber</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>instance<span class="token punctuation">)</span>
    <span class="token comment">// 将更新的state记录到fiber身上</span>
    task<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>__fiber<span class="token punctuation">.</span>partialState <span class="token operator">=</span> task<span class="token punctuation">.</span>partialState

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      props<span class="token operator">:</span> rootFiber<span class="token punctuation">.</span>props<span class="token punctuation">,</span>
      stateNode<span class="token operator">:</span> rootFiber<span class="token punctuation">.</span>stateNode<span class="token punctuation">,</span>
      tag<span class="token operator">:</span> <span class="token string">&quot;host_root&quot;</span><span class="token punctuation">,</span>
      effects<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token keyword">return</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      child<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      alternate<span class="token operator">:</span> rootFiber
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 返回最外层的fiber对象</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    props<span class="token operator">:</span> task<span class="token punctuation">.</span>props<span class="token punctuation">,</span>
    stateNode<span class="token operator">:</span> task<span class="token punctuation">.</span>dom<span class="token punctuation">,</span>
    tag<span class="token operator">:</span> <span class="token string">&quot;host_root&quot;</span><span class="token punctuation">,</span>
    effects<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">return</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    child<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    alternate<span class="token operator">:</span> task<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>__rootFiber
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> pendingCommit <span class="token operator">=</span> <span class="token keyword">null</span>

<span class="token keyword">function</span> <span class="token function">commitAllWork</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fiber<span class="token punctuation">.</span>effects<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">effect</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>effect<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">'class_component'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果是类组件,记录fiber到实例上</span>
      effect<span class="token punctuation">.</span>stateNode<span class="token punctuation">.</span>__fiber <span class="token operator">=</span> effect
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>effect<span class="token punctuation">.</span>effectTag <span class="token operator">===</span> <span class="token string">'placement'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 挂载</span>
      <span class="token keyword">let</span> currentFiber <span class="token operator">=</span> effect
      <span class="token keyword">let</span> parentFiber <span class="token operator">=</span> effect<span class="token punctuation">.</span>return

      <span class="token comment">// 如果是类组件或函数组件,需要往上找,找到普通dom节点</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>
        parentFiber<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">'class_component'</span>
        <span class="token operator">||</span> parentFiber<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">'function_component'</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parentFiber <span class="token operator">=</span> parentFiber<span class="token punctuation">.</span>return
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>currentFiber<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">'host_component'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parentFiber<span class="token punctuation">.</span>stateNode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>currentFiber<span class="token punctuation">.</span>stateNode<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>effect<span class="token punctuation">.</span>effectTag <span class="token operator">===</span> <span class="token string">'update'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 更新</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>effect<span class="token punctuation">.</span>type <span class="token operator">===</span> effect<span class="token punctuation">.</span>alternate<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 节点类型相同</span>
        <span class="token function">updateNodeElement</span><span class="token punctuation">(</span>effect<span class="token punctuation">.</span>stateNode<span class="token punctuation">,</span> effect<span class="token punctuation">,</span> effect<span class="token punctuation">.</span>alternate<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 节点类型不同</span>
        effect<span class="token punctuation">.</span>return<span class="token punctuation">.</span>stateNode<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>
          effect<span class="token punctuation">.</span>stateNode<span class="token punctuation">,</span>
          effect<span class="token punctuation">.</span>alternate<span class="token punctuation">.</span>stateNode
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>effect<span class="token punctuation">.</span>effectTag <span class="token operator">===</span> <span class="token string">'delete'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 删除</span>
      effect<span class="token punctuation">.</span>return<span class="token punctuation">.</span>stateNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>effect<span class="token punctuation">.</span>stateNode<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 备份旧的fiber对象到dom</span>
  fiber<span class="token punctuation">.</span>stateNode<span class="token punctuation">.</span>__rootFiber <span class="token operator">=</span> fiber
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">reconcileChildren</span><span class="token punctuation">(</span><span class="token parameter">returnFiber<span class="token punctuation">,</span> jsxElementChildren</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> arrifiedChildren <span class="token operator">=</span> <span class="token function">arrified</span><span class="token punctuation">(</span>jsxElementChildren<span class="token punctuation">)</span>

  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> length <span class="token punctuation">}</span> <span class="token operator">=</span> arrifiedChildren
  <span class="token keyword">let</span> jsxElement <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">let</span> newFiber <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">let</span> prevFiber <span class="token operator">=</span> <span class="token keyword">null</span>

  <span class="token keyword">let</span> alternate <span class="token operator">=</span> <span class="token keyword">null</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>returnFiber<span class="token punctuation">.</span>alternate <span class="token operator">&amp;&amp;</span> returnFiber<span class="token punctuation">.</span>alternate<span class="token punctuation">.</span>child<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    alternate <span class="token operator">=</span> returnFiber<span class="token punctuation">.</span>alternate<span class="token punctuation">.</span>child
  <span class="token punctuation">}</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> length <span class="token operator">||</span> alternate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    jsxElement <span class="token operator">=</span> arrifiedChildren<span class="token punctuation">[</span>index<span class="token punctuation">]</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>jsxElement <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>alternate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 初始渲染</span>
      newFiber <span class="token operator">=</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> jsxElement<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
        props<span class="token operator">:</span> jsxElement<span class="token punctuation">.</span>props<span class="token punctuation">,</span>
        effects<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        effectTag<span class="token operator">:</span> <span class="token string">'placement'</span><span class="token punctuation">,</span>
        tag<span class="token operator">:</span> <span class="token function">getTag</span><span class="token punctuation">(</span>jsxElement<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 指定父级</span>
        <span class="token keyword">return</span><span class="token operator">:</span> returnFiber<span class="token punctuation">,</span>
      <span class="token punctuation">}</span>

      newFiber<span class="token punctuation">.</span>stateNode <span class="token operator">=</span> <span class="token function">createStateNode</span><span class="token punctuation">(</span>newFiber<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>jsxElement <span class="token operator">&amp;&amp;</span> alternate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 更新操作</span>
      newFiber <span class="token operator">=</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> jsxElement<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
        props<span class="token operator">:</span> jsxElement<span class="token punctuation">.</span>props<span class="token punctuation">,</span>
        effects<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        effectTag<span class="token operator">:</span> <span class="token string">'update'</span><span class="token punctuation">,</span>
        tag<span class="token operator">:</span> <span class="token function">getTag</span><span class="token punctuation">(</span>jsxElement<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">return</span><span class="token operator">:</span> returnFiber<span class="token punctuation">,</span>
        alternate
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>jsxElement<span class="token punctuation">.</span>type <span class="token operator">===</span> alternate<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 类型相同: 复用旧节点</span>
        newFiber<span class="token punctuation">.</span>stateNode <span class="token operator">=</span> alternate<span class="token punctuation">.</span>stateNode
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 类型不同</span>
        newFiber<span class="token punctuation">.</span>stateNode <span class="token operator">=</span> <span class="token function">createStateNode</span><span class="token punctuation">(</span>newFiber<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>jsxElement <span class="token operator">&amp;&amp;</span> alternate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      alternate<span class="token punctuation">.</span>effectTag <span class="token operator">=</span> <span class="token string">'delete'</span>
      returnFiber<span class="token punctuation">.</span>effects<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>alternate<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      returnFiber<span class="token punctuation">.</span>child <span class="token operator">=</span> newFiber
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>jsxElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      prevFiber<span class="token punctuation">.</span>siling <span class="token operator">=</span> newFiber
    <span class="token punctuation">}</span>

    <span class="token comment">// 更新alternate</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>alternate <span class="token operator">&amp;&amp;</span> alternate<span class="token punctuation">.</span>siling<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      alternate <span class="token operator">=</span> alternate<span class="token punctuation">.</span>siling
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      alternate <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>

    prevFiber <span class="token operator">=</span> newFiber
    index<span class="token operator">++</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 执行任务, 返回新任务</span>
<span class="token comment">// 构建子级fiber</span>
<span class="token keyword">function</span> <span class="token function">executeTask</span><span class="token punctuation">(</span><span class="token parameter">returnFiber</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 构建子级fiber</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>returnFiber<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">'class_component'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 更新state</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      returnFiber<span class="token punctuation">.</span>stateNode<span class="token punctuation">.</span>__fiber
      <span class="token operator">&amp;&amp;</span> returnFiber<span class="token punctuation">.</span>stateNode<span class="token punctuation">.</span>__fiber<span class="token punctuation">.</span>partialState
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      returnFiber<span class="token punctuation">.</span>stateNode<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>returnFiber<span class="token punctuation">.</span>stateNode<span class="token punctuation">.</span>state<span class="token punctuation">,</span>
        <span class="token operator">...</span>returnFiber<span class="token punctuation">.</span>stateNode<span class="token punctuation">.</span>__fiber<span class="token punctuation">.</span>partialState
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">reconcileChildren</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">,</span> returnFiber<span class="token punctuation">.</span>stateNode<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>returnFiber<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">'function_component'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reconcileChildren</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">,</span> returnFiber<span class="token punctuation">.</span><span class="token function">stateNode</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">reconcileChildren</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">,</span> returnFiber<span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 如果有大儿子, 优先处理大儿子</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>returnFiber<span class="token punctuation">.</span>child<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> returnFiber<span class="token punctuation">.</span>child
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> currentExcuteFiber <span class="token operator">=</span> returnFiber

  <span class="token keyword">while</span> <span class="token punctuation">(</span>currentExcuteFiber<span class="token punctuation">.</span>return<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将自己合并到当前effects</span>
    currentExcuteFiber<span class="token punctuation">.</span>effects <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token operator">...</span>currentExcuteFiber<span class="token punctuation">.</span>effects<span class="token punctuation">,</span>
      currentExcuteFiber
    <span class="token punctuation">]</span>

    <span class="token comment">// 将当前effects合并到父级</span>
    currentExcuteFiber<span class="token punctuation">.</span>return<span class="token punctuation">.</span>effects <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token operator">...</span>currentExcuteFiber<span class="token punctuation">.</span>return<span class="token punctuation">.</span>effects<span class="token punctuation">,</span>
      <span class="token operator">...</span>currentExcuteFiber<span class="token punctuation">.</span>effects
    <span class="token punctuation">]</span>

    <span class="token comment">// 如果有同级, 处理兄弟节点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentExcuteFiber<span class="token punctuation">.</span>siling<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> currentExcuteFiber<span class="token punctuation">.</span>siling
    <span class="token punctuation">}</span>

    <span class="token comment">// 如果没有同级, 回退到父级, 找父级的兄弟节点</span>
    currentExcuteFiber <span class="token operator">=</span> currentExcuteFiber<span class="token punctuation">.</span>return
  <span class="token punctuation">}</span>

  <span class="token comment">// 根节点</span>
  pendingCommit <span class="token operator">=</span> currentExcuteFiber
<span class="token punctuation">}</span>

<span class="token comment">// 循环执行任务</span>
<span class="token keyword">function</span> <span class="token function">workLoop</span><span class="token punctuation">(</span><span class="token parameter">deadline</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>subTask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    subTask <span class="token operator">=</span> <span class="token function">getFirstTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>subTask <span class="token operator">&amp;&amp;</span> deadline<span class="token punctuation">.</span><span class="token function">timeRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果有子任务, 且还有剩余事件就执行任务</span>
    subTask <span class="token operator">=</span> <span class="token function">executeTask</span><span class="token punctuation">(</span>subTask<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 走到这里就协调器任务完成</span>
  <span class="token comment">// 开始把渲染页面</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pendingCommit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">commitAllWork</span><span class="token punctuation">(</span>pendingCommit<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 执行任务</span>
<span class="token keyword">function</span> <span class="token function">preformTask</span><span class="token punctuation">(</span><span class="token parameter">deadline</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 执行任务</span>
  <span class="token function">workLoop</span><span class="token punctuation">(</span>deadline<span class="token punctuation">)</span>

  <span class="token comment">// 判断是否还有任务</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>subTask <span class="token operator">||</span> <span class="token operator">!</span>taskQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 请求浏览器空闲时执行</span>
    <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>preformTask<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">jsxElement<span class="token punctuation">,</span> rootContainer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 往任务队列添加任务</span>
  taskQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    dom<span class="token operator">:</span> rootContainer<span class="token punctuation">,</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span>
      children<span class="token operator">:</span> jsxElement
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>preformTask<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">scheduleUpdate</span><span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">,</span> partialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 添加任务</span>
  taskQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'class_component'</span><span class="token punctuation">,</span>
    instance<span class="token punctuation">,</span>
    partialState
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>preformTask<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/frame/react/optimize.html" class="prev">
        性能优化
      </a></span> <span class="next"><a href="/blog/frame/react/immutable.html">
        数据不可变
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.2a6cfc5b.js" defer></script><script src="/blog/assets/js/2.a7269d81.js" defer></script><script src="/blog/assets/js/10.8ca8d11a.js" defer></script>
  </body>
</html>
