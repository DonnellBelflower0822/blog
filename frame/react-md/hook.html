<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hook | 答案的前端博客</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/blog/assets/css/0.styles.2d24539b.css" as="style"><link rel="preload" href="/blog/assets/js/app.49d9101c.js" as="script"><link rel="preload" href="/blog/assets/js/2.49ea699c.js" as="script"><link rel="preload" href="/blog/assets/js/60.9ec3cba4.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.8aa8e525.js"><link rel="prefetch" href="/blog/assets/js/11.89b1c0bf.js"><link rel="prefetch" href="/blog/assets/js/12.99054916.js"><link rel="prefetch" href="/blog/assets/js/13.7579b389.js"><link rel="prefetch" href="/blog/assets/js/14.717ead7f.js"><link rel="prefetch" href="/blog/assets/js/15.85d3e831.js"><link rel="prefetch" href="/blog/assets/js/16.75672988.js"><link rel="prefetch" href="/blog/assets/js/17.74e07c04.js"><link rel="prefetch" href="/blog/assets/js/18.01216993.js"><link rel="prefetch" href="/blog/assets/js/19.ea54b405.js"><link rel="prefetch" href="/blog/assets/js/20.4715099d.js"><link rel="prefetch" href="/blog/assets/js/21.cb876a49.js"><link rel="prefetch" href="/blog/assets/js/22.d6c697cc.js"><link rel="prefetch" href="/blog/assets/js/23.fc83629d.js"><link rel="prefetch" href="/blog/assets/js/24.25677cef.js"><link rel="prefetch" href="/blog/assets/js/25.ec9e4fe0.js"><link rel="prefetch" href="/blog/assets/js/26.4aed1f6c.js"><link rel="prefetch" href="/blog/assets/js/27.5099f8f7.js"><link rel="prefetch" href="/blog/assets/js/28.f6cd9e84.js"><link rel="prefetch" href="/blog/assets/js/29.e390d11c.js"><link rel="prefetch" href="/blog/assets/js/3.f8a17422.js"><link rel="prefetch" href="/blog/assets/js/30.05cc7bc6.js"><link rel="prefetch" href="/blog/assets/js/31.d904a25a.js"><link rel="prefetch" href="/blog/assets/js/32.ee3b399f.js"><link rel="prefetch" href="/blog/assets/js/33.73cc1ea9.js"><link rel="prefetch" href="/blog/assets/js/34.c8f9168c.js"><link rel="prefetch" href="/blog/assets/js/35.3a7c4d13.js"><link rel="prefetch" href="/blog/assets/js/36.07c8b7e4.js"><link rel="prefetch" href="/blog/assets/js/37.56aa7c94.js"><link rel="prefetch" href="/blog/assets/js/38.fd68edc9.js"><link rel="prefetch" href="/blog/assets/js/39.e343c843.js"><link rel="prefetch" href="/blog/assets/js/4.4836bb5a.js"><link rel="prefetch" href="/blog/assets/js/40.0301405c.js"><link rel="prefetch" href="/blog/assets/js/41.b50f6e9c.js"><link rel="prefetch" href="/blog/assets/js/42.6085bbe3.js"><link rel="prefetch" href="/blog/assets/js/43.e99109c9.js"><link rel="prefetch" href="/blog/assets/js/44.eeb91a1a.js"><link rel="prefetch" href="/blog/assets/js/45.81d4e6e9.js"><link rel="prefetch" href="/blog/assets/js/46.6387794e.js"><link rel="prefetch" href="/blog/assets/js/47.23742692.js"><link rel="prefetch" href="/blog/assets/js/48.a84ef4ef.js"><link rel="prefetch" href="/blog/assets/js/49.d0ecff2a.js"><link rel="prefetch" href="/blog/assets/js/5.115b0e57.js"><link rel="prefetch" href="/blog/assets/js/50.0c45a272.js"><link rel="prefetch" href="/blog/assets/js/51.340c0842.js"><link rel="prefetch" href="/blog/assets/js/52.68c0b898.js"><link rel="prefetch" href="/blog/assets/js/53.f42e7639.js"><link rel="prefetch" href="/blog/assets/js/54.73c3903c.js"><link rel="prefetch" href="/blog/assets/js/55.2d700897.js"><link rel="prefetch" href="/blog/assets/js/56.330e3784.js"><link rel="prefetch" href="/blog/assets/js/57.59391483.js"><link rel="prefetch" href="/blog/assets/js/58.522c6e97.js"><link rel="prefetch" href="/blog/assets/js/59.db137610.js"><link rel="prefetch" href="/blog/assets/js/6.d3ef550f.js"><link rel="prefetch" href="/blog/assets/js/61.975b15ca.js"><link rel="prefetch" href="/blog/assets/js/62.89b607ca.js"><link rel="prefetch" href="/blog/assets/js/63.30ec29ff.js"><link rel="prefetch" href="/blog/assets/js/64.7217b873.js"><link rel="prefetch" href="/blog/assets/js/65.205f336f.js"><link rel="prefetch" href="/blog/assets/js/66.de980a9a.js"><link rel="prefetch" href="/blog/assets/js/67.fc9971aa.js"><link rel="prefetch" href="/blog/assets/js/68.24eb2867.js"><link rel="prefetch" href="/blog/assets/js/69.9ac76c78.js"><link rel="prefetch" href="/blog/assets/js/7.95c51668.js"><link rel="prefetch" href="/blog/assets/js/70.05d2c1f1.js"><link rel="prefetch" href="/blog/assets/js/71.3061a443.js"><link rel="prefetch" href="/blog/assets/js/72.97de7321.js"><link rel="prefetch" href="/blog/assets/js/73.7abb844e.js"><link rel="prefetch" href="/blog/assets/js/74.7bf0c227.js"><link rel="prefetch" href="/blog/assets/js/75.a4305501.js"><link rel="prefetch" href="/blog/assets/js/76.0a6322e2.js"><link rel="prefetch" href="/blog/assets/js/77.075855c6.js"><link rel="prefetch" href="/blog/assets/js/78.a1740059.js"><link rel="prefetch" href="/blog/assets/js/79.6de7d07c.js"><link rel="prefetch" href="/blog/assets/js/8.018f43d1.js"><link rel="prefetch" href="/blog/assets/js/80.e51ca897.js"><link rel="prefetch" href="/blog/assets/js/81.932a162d.js"><link rel="prefetch" href="/blog/assets/js/82.875e18d8.js"><link rel="prefetch" href="/blog/assets/js/83.e9080df9.js"><link rel="prefetch" href="/blog/assets/js/84.e957ab9e.js"><link rel="prefetch" href="/blog/assets/js/85.623be81b.js"><link rel="prefetch" href="/blog/assets/js/86.8bd16ad7.js"><link rel="prefetch" href="/blog/assets/js/87.8c1f4f1a.js"><link rel="prefetch" href="/blog/assets/js/88.073f15a5.js"><link rel="prefetch" href="/blog/assets/js/89.bc9284bb.js"><link rel="prefetch" href="/blog/assets/js/9.032d2e4d.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.2d24539b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">答案的前端博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/basic/" class="nav-link">
    基础篇
  </a></div><div class="nav-item"><a href="/blog/frame/" class="nav-link router-link-active">
    框架篇
  </a></div><div class="nav-item"><a href="/blog/browser/" class="nav-link">
    浏览器
  </a></div><div class="nav-item"><a href="/blog/engine/" class="nav-link">
    工程化
  </a></div><div class="nav-item"><a href="/blog/http/" class="nav-link">
    http
  </a></div><div class="nav-item"><a href="/blog/crossEnd/" class="nav-link">
    跨端
  </a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">
    算法
  </a></div><div class="nav-item"><a href="/blog/solutions/" class="nav-link">
    解决方案
  </a></div><div class="nav-item"><a href="/blog/node-md/" class="nav-link">
    node
  </a></div><div class="nav-item"><a href="/blog/resume.html" class="nav-link">
    简历
  </a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/basic/" class="nav-link">
    基础篇
  </a></div><div class="nav-item"><a href="/blog/frame/" class="nav-link router-link-active">
    框架篇
  </a></div><div class="nav-item"><a href="/blog/browser/" class="nav-link">
    浏览器
  </a></div><div class="nav-item"><a href="/blog/engine/" class="nav-link">
    工程化
  </a></div><div class="nav-item"><a href="/blog/http/" class="nav-link">
    http
  </a></div><div class="nav-item"><a href="/blog/crossEnd/" class="nav-link">
    跨端
  </a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">
    算法
  </a></div><div class="nav-item"><a href="/blog/solutions/" class="nav-link">
    解决方案
  </a></div><div class="nav-item"><a href="/blog/node-md/" class="nav-link">
    node
  </a></div><div class="nav-item"><a href="/blog/resume.html" class="nav-link">
    简历
  </a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/blog/frame/react/" class="sidebar-heading clickable open"><span>React</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/frame/react/" class="sidebar-link">React概念及面试</a></li><li><a href="/blog/frame/react/tiny-react.html" class="sidebar-link">手写react(V15)</a></li><li><a href="/blog/frame/react/tiny-react-fiber.html" class="sidebar-link">手写react16(fiber+hook+dom-diff)</a></li><li><a href="/blog/frame/react/redux.html" class="sidebar-link">手撕redux</a></li><li><a href="/blog/frame/react/dva.html" class="sidebar-link">手撕dva</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/frame/vue/" class="sidebar-heading clickable"><span>vue</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hook"><a href="#hook" class="header-anchor">#</a> Hook</h1> <blockquote><p>它可以让你在不编写 class 的情况下使用 state 以及其他的 React 特性。</p></blockquote> <h2 id="类组件的不足"><a href="#类组件的不足" class="header-anchor">#</a> 类组件的不足</h2> <ul><li>缺少逻辑复⽤机制
<ul><li>为了复⽤逻辑增加⽆实际渲染效果的组件，增加了组件层级 显示⼗分臃肿</li> <li>增加了调试的难度以及运⾏效率的降低</li></ul></li> <li>类组件经常会变得很复杂难以维护
<ul><li>将⼀组相⼲的业务逻辑拆分到了多个⽣命周期函数中</li> <li>在⼀个⽣命周期函数内存在多个不相⼲的业务逻辑</li></ul></li> <li>类成员⽅法不能保证this指向的正确性</li></ul> <h2 id="动机"><a href="#动机" class="header-anchor">#</a> 动机</h2> <ul><li>在组件之间复用状态逻辑很难
<ul><li>Hook 使你在无需修改组件结构的情况下复用状态逻辑</li></ul></li> <li>复杂组件变得难以理解
<ul><li>Hook 将组件中相互关联的部分拆分成更小的函数</li></ul></li> <li>难以理解的 class
<ul><li>Hook 使你在非 class 的情况下可以使用更多的 React 特性</li> <li>不适用this</li></ul></li></ul> <h2 id="规则"><a href="#规则" class="header-anchor">#</a> 规则</h2> <ul><li>只在最顶层使用 Hook
<ul><li>不要在循环，条件或嵌套函数中调用 Hook</li></ul></li> <li>只在 React 函数中调用 Hook
<ul><li>react函数组件</li> <li>自定义hook里调用其他hook</li></ul></li></ul> <h2 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h2> <ul><li>维护为一个<code>hookState</code>的数组</li> <li>维护一个<code>hookIndex</code>索引,</li> <li>会根据索引去 初始化或获取原来的值</li></ul> <h2 id="usereducer"><a href="#usereducer" class="header-anchor">#</a> useReducer</h2> <ul><li>useReducer是另⼀种让函数组件保存状态的⽅式</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">ReducerAction</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">[</span>x<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">ReaducerActionSetState<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Reducer<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> action<span class="token operator">:</span> ReducerAction <span class="token operator">|</span> ReaducerActionSetState<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useReducer</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>reducer<span class="token operator">:</span> Reducer<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> initalState<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  hookState<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span> <span class="token operator">=</span> hookState<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> initalState <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function">initalState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> initalState<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> currentIndex <span class="token operator">=</span> hookIndex<span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token operator">:</span> ReducerAction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> nextState<span class="token punctuation">;</span>
    <span class="token keyword">const</span> lastState <span class="token operator">=</span> hookState<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>reducer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 处理传递reducer的情况</span>
      nextState <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>
        lastState<span class="token punctuation">,</span>
        action
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 处理reducer为null的情况</span>
      nextState <span class="token operator">=</span> <span class="token keyword">typeof</span> action <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token punctuation">(</span>action <span class="token keyword">as</span> ReaducerActionSetState<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>lastState<span class="token punctuation">)</span> <span class="token operator">:</span> action<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    hookState<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span> <span class="token operator">=</span> nextState<span class="token punctuation">;</span>

    <span class="token comment">// 更新组件</span>
    <span class="token function">fullUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    hookState<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    dispatch
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> <span class="token constant">ADD</span> <span class="token operator">=</span> <span class="token string">'ADD'</span>
<span class="token keyword">const</span> <span class="token constant">DESC</span> <span class="token operator">=</span> <span class="token string">'DESC'</span>
<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">ADD</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">number</span><span class="token operator">:</span> state<span class="token punctuation">.</span>number <span class="token operator">+</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token constant">DESC</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">number</span><span class="token operator">:</span> state<span class="token punctuation">.</span>number <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div <span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>number<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">ADD</span><span class="token punctuation">,</span>
          <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">DESC</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="react-usestate"><a href="#react-usestate" class="header-anchor">#</a> React.useState()</h2> <ul><li>⽤于为函数组件引⼊状态</li> <li>设置状态值⽅法的⽅法本身是异步的</li></ul> <p><strong>使用</strong></p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> setNumber<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>number<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">按钮</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>实现</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span>initalState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">useReducer</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> initalState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="react-usememo"><a href="#react-usememo" class="header-anchor">#</a> React.useMemo()</h2> <blockquote><p>把“创建”函数和依赖项数组作为参数传入 useMemo，它仅会在某个依赖项改变时才重新计算 memoized 值。这种优化有助于避免在每次渲染时都进行高开销的计算。
缓存值。类似vue的computed</p></blockquote> <p><strong>使用</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> data <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> number <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>number<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>实现</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// hookIndex++ 主要在进入下一个hook函数能获取正确的索引</span>
<span class="token comment">// 如果没有传deps。每次都会走重新计算的流程</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useMemo</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function-variable function">factory</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span><span class="token punctuation">,</span> deps<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
  <span class="token comment">// 初始化</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hookState<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newMemo <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hookState<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>newMemo<span class="token punctuation">,</span> deps<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> newMemo<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>lastMemo<span class="token punctuation">,</span> lastDeps<span class="token punctuation">]</span> <span class="token operator">=</span> hookState<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> same <span class="token operator">=</span> deps<span class="token operator">?.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item <span class="token operator">===</span> lastDeps<span class="token operator">?.</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>same<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果依赖项一样，直接返回缓存的值</span>
    hookIndex <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> lastMemo<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 不同则重新计算</span>
  <span class="token keyword">const</span> memoValue <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  hookState<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>memoValue<span class="token punctuation">,</span> deps<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> memoValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="react-usecallback"><a href="#react-usecallback" class="header-anchor">#</a> React.useCallback</h2> <blockquote><p>性能优化, 缓存函数, 使组件重新渲染时得到相同的函数实例.</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> handleClick <span class="token operator">=</span> CustomReact<span class="token punctuation">.</span><span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...do some thing</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>number<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>实现</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span> deps<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 初始化</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hookState<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    hookState<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> deps<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> callback<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 判断依赖项是否一样</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>lastCallback<span class="token punctuation">,</span> lastDeps<span class="token punctuation">]</span> <span class="token operator">=</span> hookState<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> same <span class="token operator">=</span> deps<span class="token operator">?.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item <span class="token operator">===</span> lastDeps<span class="token operator">?.</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>same<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 一样则返回缓存的callback</span>
    hookIndex <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> lastCallback<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 重新缓存新的callback</span>
  hookState<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> deps<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> callback<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="react-usecontext"><a href="#react-usecontext" class="header-anchor">#</a> React.useContext</h2> <ul><li>在跨组件层级获取数据时简化获取数据的代码</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> context <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useContext</span><span class="token punctuation">(</span>CounterContext<span class="token punctuation">)</span>
</code></pre></div><p><strong>实现</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 跟React.createContext的实现原理对应</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useContext</span><span class="token punctuation">(</span>Context<span class="token operator">:</span> <span class="token punctuation">{</span> Provider<span class="token operator">:</span> <span class="token punctuation">{</span> _value<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Context<span class="token punctuation">.</span>Provider<span class="token punctuation">.</span>_value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="react-useeffect"><a href="#react-useeffect" class="header-anchor">#</a> React.useEffect</h2> <ul><li>让函数型组件拥有处理副作⽤的能⼒. 类似⽣命周期函数.</li> <li>useEffect Hook 看做 componentDidMount，componentDidUpdate 和 componentWillUnmount 这三个函数的组合。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  
  React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'use Effect'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">count</span> <span class="token operator">=&gt;</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="结合异步函数"><a href="#结合异步函数" class="header-anchor">#</a> 结合异步函数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// useEffect的第一个参数不能是异步函数</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="模拟componentdidmount"><a href="#模拟componentdidmount" class="header-anchor">#</a> 模拟componentDidMount</h3> <div class="language-js extra-class"><pre class="language-js"><code>React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// componentDidMount</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="模拟componentdidupdate"><a href="#模拟componentdidupdate" class="header-anchor">#</a> 模拟componentDidUpdate</h3> <div class="language-js extra-class"><pre class="language-js"><code>React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// componentDidUpdate</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="模拟componentwillunmount"><a href="#模拟componentwillunmount" class="header-anchor">#</a> 模拟componentWillUnmount</h3> <div class="language-js extra-class"><pre class="language-js"><code>React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// componentWillUnmount</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用宏任务。浏览器ui渲染后才执行</span>
type <span class="token function-variable function">DestyoryFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> DestyoryFn<span class="token punctuation">,</span> deps<span class="token operator">?</span><span class="token operator">:</span> unknown<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> currentHook <span class="token operator">=</span> hookIndex<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hookState<span class="token punctuation">[</span>currentHook<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 初始化</span>
    <span class="token comment">// 在宏任务中执行</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 先执行一次</span>
      <span class="token keyword">const</span> destoryFunction <span class="token operator">=</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      hookState<span class="token punctuation">[</span>currentHook<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>destoryFunction<span class="token punctuation">,</span> deps<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hookIndex <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>destoryFunction<span class="token punctuation">,</span> lastDeps<span class="token punctuation">]</span> <span class="token operator">=</span> hookState<span class="token punctuation">[</span>currentHook<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> same <span class="token operator">=</span> deps<span class="token operator">?.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item <span class="token operator">===</span> lastDeps<span class="token operator">?.</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//  如果依赖项一样，则不需要执行effect</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>same<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    hookIndex<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 调用销毁函数</span>
  destoryFunction<span class="token operator">?.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 重新执行</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> destoryFunction <span class="token operator">=</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hookState<span class="token punctuation">[</span>currentHook<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>destoryFunction<span class="token punctuation">,</span> deps<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  hookIndex <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="react-uselayouteffect"><a href="#react-uselayouteffect" class="header-anchor">#</a> React.useLayoutEffect</h2> <p><strong>使用</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  
  <span class="token comment">// 会有动画效果</span>
  <span class="token comment">// 因为useEffect是在宏任务才执行。也就是说浏览器ui渲染`之后`才执行</span>
  React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">'translate(500px)'</span>
    ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">'500ms'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment">// 不会有动画效果</span>
  <span class="token comment">// 因为useLayoutEffect是在微任务才执行。也就是说浏览器ui渲染`之前`才执行</span>
  React<span class="token punctuation">.</span><span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">'translate(500px)'</span>
    ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">'500ms'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'100px'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'100px'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'red'</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>实现</strong></p> <blockquote><p>跟useEffect的区别就是queueMicrotask</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 微任务。在浏览器ui渲染之前执行: queueMicrotask</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> DestyoryFn<span class="token punctuation">,</span> deps<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> currentHookIndex <span class="token operator">=</span> hookIndex<span class="token punctuation">;</span>
  <span class="token comment">// 初始化</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hookState<span class="token punctuation">[</span>currentHookIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> destoryFunction <span class="token operator">=</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      hookState<span class="token punctuation">[</span>currentHookIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>destoryFunction<span class="token punctuation">,</span> deps<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hookIndex <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>destoryFunction<span class="token punctuation">,</span> lastDeps<span class="token punctuation">]</span> <span class="token operator">=</span> hookState<span class="token punctuation">[</span>currentHookIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> same <span class="token operator">=</span> deps<span class="token operator">?.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item <span class="token operator">===</span> lastDeps<span class="token operator">?.</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>same<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    hookIndex<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 重新执行。先调用销毁函数。在微任务重新执行</span>
  destoryFunction<span class="token operator">?.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> destoryFunction <span class="token operator">=</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hookState<span class="token punctuation">[</span>currentHookIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>destoryFunction<span class="token punctuation">,</span> deps<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  hookIndex <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="react-forwardref"><a href="#react-forwardref" class="header-anchor">#</a> React.forwardRef</h2> <blockquote><p>像外部组件想获取函数组件的ref
但是有安全性问题。给到父组件的ref完全暴露。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">Sub</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> ForwardedSub <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span>Sub<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> childRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>ForwardedSub ref<span class="token operator">=</span><span class="token punctuation">{</span>childRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        childRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 直接可以干掉子级</span>
        <span class="token comment">// childRef.current.remove()</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>获得焦点<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>实现</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'React'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span>FunctionComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token keyword">extends</span></span> Component <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>FunctionComponent<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 提示</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token function">FunctionComponent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ref<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在类组件</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>reactNode<span class="token punctuation">.</span>ref<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  reactNode<span class="token punctuation">.</span>ref<span class="token punctuation">.</span>current <span class="token operator">=</span> instance<span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span>ref <span class="token operator">=</span> reactNode<span class="token punctuation">.</span>ref<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="react-useimperativehandle"><a href="#react-useimperativehandle" class="header-anchor">#</a> React.useImperativeHandle</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token comment">// ref会作为函数组件第二个参数</span>
<span class="token keyword">function</span> <span class="token function">Sub</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
  React<span class="token punctuation">.</span><span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 返回选择暴露给调用组件的方法/属性</span>
    <span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> ForwardedSub <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span>Sub<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> childRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>ForwardedSub ref<span class="token operator">=</span><span class="token punctuation">{</span>childRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        childRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 报错</span>
        childRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>获得焦点<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>实现</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// useImperativeHandle 可以让你在使用 ref 时自定义暴露给父组件的实例值</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> factoy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ref<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">factoy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="react-useref"><a href="#react-useref" class="header-anchor">#</a> React.useRef</h2> <ul><li>获取DOM元素对象</li> <li>保存数据 (跨组件周期)
<ul><li>即使组件重新渲染, 保存的数据仍然还在. 保存的数据被更改不会触发组件重新渲染</li></ul></li></ul> <p><strong>使用</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> childRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>实现</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useRef</span><span class="token punctuation">(</span>initialState<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  hookState<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span> <span class="token operator">=</span> hookState<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">{</span> current<span class="token operator">:</span> initialState <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> hookState<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="自定义hook"><a href="#自定义hook" class="header-anchor">#</a> 自定义hook</h2> <ul><li>⾃定义 Hook 是标准的封装和共享逻辑的⽅式.</li> <li>⾃定义 Hook 是⼀个函数, 其名称以 use 开头.</li> <li>⾃定义 Hook 其实就是逻辑和内置 Hook 的组合.</li></ul> <h2 id="hook获取不到最新的值"><a href="#hook获取不到最新的值" class="header-anchor">#</a> hook获取不到最新的值</h2> <ul><li>函数组件其实是一个闭包。每个函数执行都是新的</li> <li>获取不到最新的值。只能获取当时闭包的值</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 由于函数组件都是一个闭包。</span>
        <span class="token comment">// 获取不到最新的值，只能获取到“当时”的值</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>  <span class="token comment">// 0</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 页面最后显示的是1</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handler<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="使用react-useref保存最新的值"><a href="#使用react-useref保存最新的值" class="header-anchor">#</a> 使用React.useRef保存最新的值</h2> <ul><li>使用React.useRef多次获取都是同一个</li> <li>使用React.createRef每次都是新的</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> countRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    countRef<span class="token punctuation">.</span>current <span class="token operator">=</span> count
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>  <span class="token comment">// 0</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>countRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>  <span class="token comment">// 永远是最新值</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 页面最后显示的是1</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handler<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="hook进行数据获取"><a href="#hook进行数据获取" class="header-anchor">#</a> hook进行数据获取</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// todo some request</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>aaaaa<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="类似类实例属性"><a href="#类似类实例属性" class="header-anchor">#</a> 类似类实例属性</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> intervalRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    intervalRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// do some thing</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 类似实例的属性</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span>stop<span class="token punctuation">}</span><span class="token operator">&gt;</span>Hello<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="只有在更新时执行"><a href="#只有在更新时执行" class="header-anchor">#</a> 只有在更新时执行</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token comment">// 只有在更新时执行</span>
<span class="token keyword">function</span> <span class="token function">useUpdateEffect</span><span class="token punctuation">(</span><span class="token parameter">updateFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> flagRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flagRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      flagRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">updateFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token function">useUpdateEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'update'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">setState</span><span class="token punctuation">(</span>state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>state<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="获取上一次的值"><a href="#获取上一次的值" class="header-anchor">#</a> 获取上一次的值</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">usePrevious</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> prevCountRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    prevCountRef<span class="token punctuation">.</span>current <span class="token operator">=</span> count
    <span class="token keyword">debugger</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> prevCountRef<span class="token punctuation">.</span>current
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> previousState <span class="token operator">=</span> <span class="token function">usePrevious</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'上一次state'</span><span class="token punctuation">,</span> previousState<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'当前state'</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>
      <span class="token function">setState</span><span class="token punctuation">(</span>state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>state<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="强制更新"><a href="#强制更新" class="header-anchor">#</a> 强制更新</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">useForceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> forceUpdate<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useReducer</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> forceUpdate
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> forceUpdate <span class="token operator">=</span> <span class="token function">useForceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'更新'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">{</span>forceUpdate<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token number">11</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.49d9101c.js" defer></script><script src="/blog/assets/js/2.49ea699c.js" defer></script><script src="/blog/assets/js/60.9ec3cba4.js" defer></script>
  </body>
</html>
