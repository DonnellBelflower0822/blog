<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基础 | 答案的前端博客</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/blog/assets/css/0.styles.8cb9eb99.css" as="style"><link rel="preload" href="/blog/assets/js/app.80c9f677.js" as="script"><link rel="preload" href="/blog/assets/js/2.6d1c2cae.js" as="script"><link rel="preload" href="/blog/assets/js/60.10528cdc.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.41a8428a.js"><link rel="prefetch" href="/blog/assets/js/11.b0bec025.js"><link rel="prefetch" href="/blog/assets/js/12.a34d676a.js"><link rel="prefetch" href="/blog/assets/js/13.461b48d4.js"><link rel="prefetch" href="/blog/assets/js/14.14802101.js"><link rel="prefetch" href="/blog/assets/js/15.a38a0a6a.js"><link rel="prefetch" href="/blog/assets/js/16.1f8dc30c.js"><link rel="prefetch" href="/blog/assets/js/17.c8244ddc.js"><link rel="prefetch" href="/blog/assets/js/18.b71e3edd.js"><link rel="prefetch" href="/blog/assets/js/19.22395df0.js"><link rel="prefetch" href="/blog/assets/js/20.cf8613ca.js"><link rel="prefetch" href="/blog/assets/js/21.94aa76f2.js"><link rel="prefetch" href="/blog/assets/js/22.966b5649.js"><link rel="prefetch" href="/blog/assets/js/23.0cd156aa.js"><link rel="prefetch" href="/blog/assets/js/24.52ab4ccf.js"><link rel="prefetch" href="/blog/assets/js/25.e001b3ef.js"><link rel="prefetch" href="/blog/assets/js/26.4e71d064.js"><link rel="prefetch" href="/blog/assets/js/27.3615143d.js"><link rel="prefetch" href="/blog/assets/js/28.f1ea71f2.js"><link rel="prefetch" href="/blog/assets/js/29.cb3a3123.js"><link rel="prefetch" href="/blog/assets/js/3.a107965c.js"><link rel="prefetch" href="/blog/assets/js/30.3b87cb2b.js"><link rel="prefetch" href="/blog/assets/js/31.b17f9305.js"><link rel="prefetch" href="/blog/assets/js/32.20bc781c.js"><link rel="prefetch" href="/blog/assets/js/33.6b09452a.js"><link rel="prefetch" href="/blog/assets/js/34.aa59556f.js"><link rel="prefetch" href="/blog/assets/js/35.ee051d86.js"><link rel="prefetch" href="/blog/assets/js/36.82f7fcd9.js"><link rel="prefetch" href="/blog/assets/js/37.3c8db016.js"><link rel="prefetch" href="/blog/assets/js/38.47483fba.js"><link rel="prefetch" href="/blog/assets/js/39.6c173afb.js"><link rel="prefetch" href="/blog/assets/js/4.6f9be1e0.js"><link rel="prefetch" href="/blog/assets/js/40.9314b656.js"><link rel="prefetch" href="/blog/assets/js/41.a7131031.js"><link rel="prefetch" href="/blog/assets/js/42.4c20ac8a.js"><link rel="prefetch" href="/blog/assets/js/43.9391013c.js"><link rel="prefetch" href="/blog/assets/js/44.0e387203.js"><link rel="prefetch" href="/blog/assets/js/45.91359168.js"><link rel="prefetch" href="/blog/assets/js/46.7da64bdd.js"><link rel="prefetch" href="/blog/assets/js/47.072e5d43.js"><link rel="prefetch" href="/blog/assets/js/48.f153e374.js"><link rel="prefetch" href="/blog/assets/js/49.f4ff0522.js"><link rel="prefetch" href="/blog/assets/js/5.0f2914c9.js"><link rel="prefetch" href="/blog/assets/js/50.265d5008.js"><link rel="prefetch" href="/blog/assets/js/51.fd0b30ec.js"><link rel="prefetch" href="/blog/assets/js/52.445747ed.js"><link rel="prefetch" href="/blog/assets/js/53.1a738f4d.js"><link rel="prefetch" href="/blog/assets/js/54.29522faf.js"><link rel="prefetch" href="/blog/assets/js/55.daf46a4d.js"><link rel="prefetch" href="/blog/assets/js/56.98d0ac3a.js"><link rel="prefetch" href="/blog/assets/js/57.41d9a74c.js"><link rel="prefetch" href="/blog/assets/js/58.14dab6d6.js"><link rel="prefetch" href="/blog/assets/js/59.82c4a9ff.js"><link rel="prefetch" href="/blog/assets/js/6.0582cd93.js"><link rel="prefetch" href="/blog/assets/js/61.01536ef3.js"><link rel="prefetch" href="/blog/assets/js/62.890442bb.js"><link rel="prefetch" href="/blog/assets/js/63.5e005cf4.js"><link rel="prefetch" href="/blog/assets/js/64.975bf77b.js"><link rel="prefetch" href="/blog/assets/js/65.c6999bb1.js"><link rel="prefetch" href="/blog/assets/js/66.4c30fb12.js"><link rel="prefetch" href="/blog/assets/js/67.3d57c6f4.js"><link rel="prefetch" href="/blog/assets/js/68.e4b79956.js"><link rel="prefetch" href="/blog/assets/js/69.5a3a3918.js"><link rel="prefetch" href="/blog/assets/js/7.3532d01b.js"><link rel="prefetch" href="/blog/assets/js/70.ae42243e.js"><link rel="prefetch" href="/blog/assets/js/71.b34f39f9.js"><link rel="prefetch" href="/blog/assets/js/72.32c080de.js"><link rel="prefetch" href="/blog/assets/js/73.4697802c.js"><link rel="prefetch" href="/blog/assets/js/74.74ecd09a.js"><link rel="prefetch" href="/blog/assets/js/75.215f0dfc.js"><link rel="prefetch" href="/blog/assets/js/76.d14cf585.js"><link rel="prefetch" href="/blog/assets/js/77.a167e3a7.js"><link rel="prefetch" href="/blog/assets/js/78.d57f8ead.js"><link rel="prefetch" href="/blog/assets/js/8.65be3530.js"><link rel="prefetch" href="/blog/assets/js/9.83554b82.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.8cb9eb99.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">答案的前端博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/basic/" class="nav-link">
    基础篇
  </a></div><div class="nav-item"><a href="/blog/frame/" class="nav-link router-link-active">
    框架篇
  </a></div><div class="nav-item"><a href="/blog/browser/" class="nav-link">
    浏览器
  </a></div><div class="nav-item"><a href="/blog/engine/" class="nav-link">
    工程化
  </a></div><div class="nav-item"><a href="/blog/http/" class="nav-link">
    http
  </a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">
    算法
  </a></div><div class="nav-item"><a href="/blog/solutions/" class="nav-link">
    解决方案
  </a></div><div class="nav-item"><a href="/blog/node-md/" class="nav-link">
    node
  </a></div><div class="nav-item"><a href="/blog/resume.html" class="nav-link">
    简历
  </a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/basic/" class="nav-link">
    基础篇
  </a></div><div class="nav-item"><a href="/blog/frame/" class="nav-link router-link-active">
    框架篇
  </a></div><div class="nav-item"><a href="/blog/browser/" class="nav-link">
    浏览器
  </a></div><div class="nav-item"><a href="/blog/engine/" class="nav-link">
    工程化
  </a></div><div class="nav-item"><a href="/blog/http/" class="nav-link">
    http
  </a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">
    算法
  </a></div><div class="nav-item"><a href="/blog/solutions/" class="nav-link">
    解决方案
  </a></div><div class="nav-item"><a href="/blog/node-md/" class="nav-link">
    node
  </a></div><div class="nav-item"><a href="/blog/resume.html" class="nav-link">
    简历
  </a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/blog/frame/react/" class="sidebar-heading clickable"><span>React</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/frame/vue/" aria-current="page" class="sidebar-heading clickable router-link-exact-active router-link-active open active"><span>vue</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/frame/vue/" aria-current="page" class="active sidebar-link">基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frame/vue/#spa的理解-优缺点" class="sidebar-link">spa的理解,优缺点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frame/vue/#优点" class="sidebar-link">优点：</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#缺点" class="sidebar-link">缺点：</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#computed-和-watch" class="sidebar-link">computed 和 watch</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frame/vue/#场景" class="sidebar-link">场景</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#vue2的数组" class="sidebar-link">vue2的数组</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#指令" class="sidebar-link">指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frame/vue/#注册" class="sidebar-link">注册</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#定义" class="sidebar-link">定义</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#使用" class="sidebar-link">使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#请求放在那个钩子函数" class="sidebar-link">请求放在那个钩子函数</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#组件通信" class="sidebar-link">组件通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frame/vue/#示例" class="sidebar-link">示例</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#props-emit-el-input" class="sidebar-link">props/emit - el-input</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#parent-childen" class="sidebar-link">$parent/$childen</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#provider-inject" class="sidebar-link">provider/inject</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#v-model" class="sidebar-link">v-model</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#问题" class="sidebar-link">问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frame/vue/#mvvm" class="sidebar-link">MVVM</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#响应式" class="sidebar-link">响应式</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#依赖收集" class="sidebar-link">依赖收集</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#模板编译" class="sidebar-link">模板编译</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#生命周期-2" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#每个生命周期" class="sidebar-link">每个生命周期</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#vue-mixin" class="sidebar-link">Vue.mixin</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#vue组件data为什么是函数" class="sidebar-link">Vue组件data为什么是函数</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#nexttick" class="sidebar-link">nextTick</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frame/vue/#实现" class="sidebar-link">实现</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#computed和watch" class="sidebar-link">computed和watch</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#set" class="sidebar-link">$set</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#虚拟dom" class="sidebar-link">虚拟dom</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#diff" class="sidebar-link">diff</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#数据劫持为什么还需要dom-diff来监测差异" class="sidebar-link">数据劫持为什么还需要dom-diff来监测差异</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#key" class="sidebar-link">key</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#组件化" class="sidebar-link">组件化</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#组件渲染流程" class="sidebar-link">组件渲染流程</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#异步组件" class="sidebar-link">异步组件</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#vue响应式" class="sidebar-link">vue响应式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frame/vue/#object-defineproperty" class="sidebar-link">Object.defineProperty</a></li><li class="sidebar-sub-header"><a href="/blog/frame/vue/#proxy" class="sidebar-link">proxy</a></li></ul></li></ul></li><li><a href="/blog/frame/vue/my-vue2.html" class="sidebar-link">手写vue2</a></li><li><a href="/blog/frame/vue/my-vue2-router.html" class="sidebar-link">手写vue2-router</a></li><li><a href="/blog/frame/vue/my-vue2-vuex.html" class="sidebar-link">手写vuex(vue2)</a></li><li><a href="/blog/frame/vue/my-vue2-ssr.html" class="sidebar-link">服务端渲染</a></li><li><a href="/blog/frame/vue/my-vue3.html" class="sidebar-link">手写vue3</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="基础"><a href="#基础" class="header-anchor">#</a> 基础</h1> <ul><li>常用组件的实现原理</li></ul> <h2 id="spa的理解-优缺点"><a href="#spa的理解-优缺点" class="header-anchor">#</a> spa的理解,优缺点</h2> <blockquote><p>SPA（ single-page application ）仅在 Web 页面初始化时加载相应的 HTML、JavaScript 和 CSS。一旦页面加载完成，SPA 不会因为用户的操作而进行页面的重新加载或跳转；取而代之的是利用路由机制实现 HTML 内容的变换，UI 与用户的交互，避免页面的重新加载。</p></blockquote> <h3 id="优点"><a href="#优点" class="header-anchor">#</a> 优点：</h3> <ul><li>用户体验好、快，内容的改变不需要重新加载整个页面，避免了不必要的跳转和重复渲染；</li> <li>基于上面一点，SPA 相对对服务器压力小；</li> <li>前后端职责分离，架构清晰，前端进行交互逻辑，后端负责数据处理；</li></ul> <h3 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点：</h3> <ul><li>初次加载耗时多：为实现单页 Web 应用功能及显示效果，需要在加载页面的时候将 JavaScript、CSS 统一加载，部分页面按需加载；</li> <li>前进后退路由管理：由于单页应用在一个页面中显示所有的内容，所以不能使用浏览器的前进后退功能，所有的页面切换需要自己建立堆栈管理；</li> <li>SEO 难度较大：由于所有的内容都在一个页面中动态替换显示，所以在 SEO 上其有着天然的弱势。</li></ul> <h2 id="computed-和-watch"><a href="#computed-和-watch" class="header-anchor">#</a> computed 和 watch</h2> <ul><li>computed：
<ul><li>是计算属性，依赖其它属性值</li> <li>并且 computed 的值有缓存，只有它依赖的属性值发生改变，下一次获取 computed 的值时才会重新计算 computed  的值；</li></ul></li> <li>watch：
<ul><li>更多的是「观察」的作用，</li> <li>类似于某些数据的监听回调 ，每当监听的数据变化时都会执行回调进行后续操作；</li></ul></li></ul> <h3 id="场景"><a href="#场景" class="header-anchor">#</a> 场景</h3> <ul><li>当我们需要进行数值计算，并且依赖于其它数据时，应该使用 computed，因为可以利用 computed 的缓存特性，避免每次获取值时，都要重新计算；</li> <li>当我们需要在数据变化时执行异步或开销较大的操作时，应该使用 watch，使用 watch 选项允许我们执行异步操作 ( 访问一个 API )，限制我们执行该操作的频率，并在我们得到最终结果前，设置中间状态。这些都是计算属性无法做到的。</li></ul> <h2 id="vue2的数组"><a href="#vue2的数组" class="header-anchor">#</a> vue2的数组</h2> <ul><li>通过push,pop,shift,unshift,splice,sort方法，vue才能监测到数组变化</li> <li>this.$set()</li></ul> <h2 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h2> <h2 id="指令"><a href="#指令" class="header-anchor">#</a> 指令</h2> <ul><li>可以复用</li> <li>核心是控制dom</li></ul> <h3 id="注册"><a href="#注册" class="header-anchor">#</a> 注册</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 全局</span>
Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 组件内部</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  directives<span class="token operator">:</span> <span class="token punctuation">{</span>
    focus<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="定义"><a href="#定义" class="header-anchor">#</a> 定义</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  directives<span class="token operator">:</span> <span class="token punctuation">{</span>
    clickOutside<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">bind</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> bindings<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> fn <span class="token operator">=</span> vnode<span class="token punctuation">.</span>context<span class="token punctuation">[</span>bindings<span class="token punctuation">.</span>expression<span class="token punctuation">]</span>
            <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        el<span class="token punctuation">.</span>handler <span class="token operator">=</span> handler
        document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'参数:'</span><span class="token punctuation">,</span> bindings<span class="token punctuation">.</span>modifiers<span class="token punctuation">)</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'vue实例:'</span><span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>context<span class="token punctuation">)</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'当前dom:'</span><span class="token punctuation">,</span> el<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">unbind</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token operator">?.</span>handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> el<span class="token operator">?.</span>handler<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-click-outside.a</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hide<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@focus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>show<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isShow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="请求放在那个钩子函数"><a href="#请求放在那个钩子函数" class="header-anchor">#</a> 请求放在那个钩子函数</h2> <ul><li>created和mounted都可以的</li> <li>在服务端渲染中只支持created</li></ul> <h2 id="组件通信"><a href="#组件通信" class="header-anchor">#</a> 组件通信</h2> <ul><li>props,emits</li> <li>$attrs/$listener</li> <li>$parent/$children</li> <li>$refs</li> <li>provider/inject</li> <li>eventBus</li> <li>vuex</li></ul> <h3 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h3> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:rules</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rules<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user.name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>age<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user.age<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="props-emit-el-input"><a href="#props-emit-el-input" class="header-anchor">#</a> props/emit - el-input</h3> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleChange<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
      <span class="token comment">// this.$emit('update:value', e.target.value)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$dispatch</span><span class="token punctuation">(</span><span class="token string">'ElFormItem'</span><span class="token punctuation">,</span> <span class="token string">'changeValue'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="parent-childen"><a href="#parent-childen" class="header-anchor">#</a> $parent/$childen</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$dispatch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent
  <span class="token keyword">while</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>name <span class="token operator">===</span> componentName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 触发实例的方法, 对应实例需要$on监听此事件</span>
    parent<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> parent
<span class="token punctuation">}</span>
</code></pre></div><h3 id="provider-inject"><a href="#provider-inject" class="header-anchor">#</a> provider/inject</h3> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$broadcast</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">componentName<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$children

  <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token keyword">function</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>name <span class="token operator">===</span> componentName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          child<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>$children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">find</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>$children<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">find</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span>
  <span class="token keyword">return</span> arr
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ElForm'</span><span class="token punctuation">,</span>
  <span class="token comment">// 为子提供</span>
  <span class="token function">provide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">elForm</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">validate</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$broadcast</span><span class="token punctuation">(</span><span class="token string">'ElFormItem'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      cb<span class="token operator">?.</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="v-model"><a href="#v-model" class="header-anchor">#</a> v-model</h2> <p>在组件上&lt;Com :value='value' @change='val =&gt; value =val'&gt;</p> <h2 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h2> <h3 id="mvvm"><a href="#mvvm" class="header-anchor">#</a> MVVM</h3> <ul><li>隐藏controller</li> <li>映射关系简化</li> <li>model,view,viewModel</li> <li>Vue的核心库只关注视图层</li></ul> <h3 id="响应式"><a href="#响应式" class="header-anchor">#</a> 响应式</h3> <ul><li>对象
<ul><li>对象内部通过defineReactive方法，使用Object.defineProperty对属性进行劫持（只劫持已经存在的属性）</li> <li>多层对象通过递归劫持</li></ul></li> <li>数组
<ul><li>数组通过重写实例上__proto__的pop，push，unshift，shift，sort，splice，reverse方法实现数据劫持</li> <li>数组的索引和长度变化无法更改</li> <li>数组中子项也是对象，递归劫持</li></ul></li> <li>数组和对象本身维护一个dep</li></ul> <h3 id="依赖收集"><a href="#依赖收集" class="header-anchor">#</a> 依赖收集</h3> <ul><li>每个属性拥有自己的dep属性，存放他所依赖的watcher。</li> <li>初始化时会调用render，就用触发属性的get，从而收集依赖<code>dep.depend()</code></li> <li>属性发生修改时，触发watcher更新操作<code>dep.notify()</code></li></ul> <h3 id="模板编译"><a href="#模板编译" class="header-anchor">#</a> 模板编译</h3> <blockquote><p>template转换成render函数</p></blockquote> <ul><li>将template转换成ast</li> <li>做静态语法做静态标记</li> <li>生成render函数</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">compileToFunction</span><span class="token punctuation">(</span>template<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. 将template转换成ast</span>
  <span class="token comment">// '&lt;div id=&quot;app&quot;&gt;&lt;div&gt;{{name}}&lt;/div&gt;&lt;div&gt;{{name}}&lt;/div&gt;&lt;/div&gt;'(string) -&gt; ast:Ast</span>
  <span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">parserHTML</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2. 对静态语法做静态标记</span>
  <span class="token comment">// ast -&gt; &quot;_c('div',id=&quot;app&quot;,style={&quot;color&quot;:&quot;red&quot;,&quot;backgroundColor&quot;:&quot; blue&quot;},_c('div',undefined,_v(&quot;hello-&quot;+name+&quot;world&quot;)))&quot;</span>
  <span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 3. 重新生成代码</span>
  <span class="token comment">// string -&gt; render</span>
  <span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Function</span></span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">with(this){return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token keyword">as</span> Render<span class="token punctuation">;</span>
  <span class="token keyword">return</span> render<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">_c</span><span class="token punctuation">(</span>
  <span class="token string">'div'</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>attrs<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>
    <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        staticClass<span class="token operator">:</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span>
        staticStyle<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;background-color&quot;</span><span class="token operator">:</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">_s</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">_s</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Ast</span> <span class="token punctuation">{</span>
  tag<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">3</span><span class="token punctuation">;</span>
  children<span class="token operator">:</span> Ast<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  parent<span class="token operator">:</span> Ast <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  attrs<span class="token operator">:</span> Attr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  text<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="生命周期-2"><a href="#生命周期-2" class="header-anchor">#</a> 生命周期</h3> <ul><li>生命周期钩子就是回调函数，在创建组件实例中调用对应的钩子方法</li> <li>内部会对钩子函数进行处理，将钩子函数维护成数组的形式</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>vm <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">$options</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">beforeCreate</span><span class="token operator">:</span> <span class="token punctuation">[</span>beforeCreate1<span class="token punctuation">,</span>beforeCreate2<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="每个生命周期"><a href="#每个生命周期" class="header-anchor">#</a> 每个生命周期</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 初始化：组件父子关系</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'parent beforeCreate'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 响应式数据</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'parent created'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 挂载之前：</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'parent beforeMount'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 新创建$el,并且挂载到实例上</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'parent mounted'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 数据更新之前</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'parent beforeUpdate'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">updated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 数据更新完成</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'parent updated'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 实例销毁之前，实例仍然完全可用</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'parent beforeDestroy'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">destroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'parent destroyed'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="vue-mixin"><a href="#vue-mixin" class="header-anchor">#</a> Vue.mixin</h2> <ul><li>抽离公共的业务逻辑</li> <li>缺点
<ul><li>命名冲突</li> <li>依赖</li> <li>数据来源不明</li></ul></li></ul> <h2 id="vue组件data为什么是函数"><a href="#vue组件data为什么是函数" class="header-anchor">#</a> Vue组件data为什么是函数</h2> <ul><li>如果是对象，在mixin的时候会合并，保存都是同一引用地址，数据会被污染</li></ul> <h2 id="nexttick"><a href="#nexttick" class="header-anchor">#</a> nextTick</h2> <ul><li>数据更改是异步更新,nextTick保存数据更新后才执行，能拿到最新的dom</li> <li>封装<code>$nextTick</code>能保证先后顺序，内部的<code>渲染watcher</code>等会先于用户通过<code>this.$nextTick</code></li></ul> <h3 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h3> <blockquote><p>换一种写法。vue2的方法有多种降级兼容。vue3就Promise.resolve().then</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    waiting <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token function">timerFn</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">timerFn</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 支持Promise</span>
    <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>MutationObserver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// MutationObserver</span>
    <span class="token keyword">const</span> textnode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>textnode<span class="token punctuation">,</span> <span class="token punctuation">{</span> characterData<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    textnode<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'2'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>setImmediate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// setImmediate</span>
    <span class="token function">setImmediate</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// setTimeout</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="computed和watch"><a href="#computed和watch" class="header-anchor">#</a> computed和watch</h2> <ul><li>同时基于watcher实现</li> <li>computed
<ul><li>具备缓存，依赖的值不发生变化，不会重新执行计算方法</li> <li>获取computed值时才去执行计算方法</li> <li>依赖值发生变化也不会立即执行计算方法，只有下一次获取computed值时才会重新计算</li></ul></li> <li>watch是监控值变化，当值发生改变是调用回调函数</li></ul> <h2 id="set"><a href="#set" class="header-anchor">#</a> $set</h2> <ul><li>对象和数组本身都有dep属性</li> <li>数组：调用splice</li> <li>对象：调用defineReactive</li></ul> <h2 id="虚拟dom"><a href="#虚拟dom" class="header-anchor">#</a> 虚拟dom</h2> <ul><li>用js来描述真实dom，是对真实DOM的抽象</li> <li>跨平台</li> <li>进行dom-diff，对比新旧虚拟DOM的差异进行更新。</li> <li>保证更新的下限</li></ul> <h2 id="diff"><a href="#diff" class="header-anchor">#</a> diff</h2> <h2 id="数据劫持为什么还需要dom-diff来监测差异"><a href="#数据劫持为什么还需要dom-diff来监测差异" class="header-anchor">#</a> 数据劫持为什么还需要dom-diff来监测差异</h2> <ul><li>如果给每个属性都添加watcher，会产生大量的watcher，从而降低性能</li> <li>颗粒过细会导致更新不准确</li> <li>vue采用组件级更新，渲染watcher</li></ul> <h2 id="key"><a href="#key" class="header-anchor">#</a> key</h2> <ul><li>以key作为判断是否相同节点的依据。如果相同就可以复用</li></ul> <h2 id="组件化"><a href="#组件化" class="header-anchor">#</a> 组件化</h2> <ul><li>提高应用开发效率，测试性，复用性</li> <li>组件话：属性，自定义事件，插槽</li> <li>降低更新范围，只重新渲染变化组件</li> <li>组件特点：
<ul><li>高内聚</li> <li>低耦合</li> <li>单线数据流</li></ul></li></ul> <h2 id="组件渲染流程"><a href="#组件渲染流程" class="header-anchor">#</a> 组件渲染流程</h2> <h2 id="异步组件"><a href="#异步组件" class="header-anchor">#</a> 异步组件</h2> <ul><li>默认渲染异步组件会先放个占位符</li> <li>等到组件加载完毕后调用自己的强制更新forceUpdate</li></ul> <h2 id="vue响应式"><a href="#vue响应式" class="header-anchor">#</a> vue响应式</h2> <h3 id="object-defineproperty"><a href="#object-defineproperty" class="header-anchor">#</a> Object.defineProperty</h3> <blockquote><p>每个属性的测试</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 基础使用</span>
<span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'hello'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// { name: 'hello' } []</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">/**
 * 测试枚举:enumerable
 * 默认是false
 */</span>
<span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 是否可枚举</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'hello'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// { name: 'hello' } [ 'name' ]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">/**
 * 是否可删除：configurable
 */</span>
<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj2<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 能不能删除</span>
  <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'hello'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">delete</span> obj2<span class="token punctuation">.</span>name
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { name: 'hello' }</span>

<span class="token comment">/**
 * 是否重写: writable
 */</span>
<span class="token keyword">const</span> obj3 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj3<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>
  <span class="token comment">// 是否重写</span>
  <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

obj3<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'tom'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { name: 'hello' }</span>

<span class="token comment">/**
 * get,set
 */</span>
<span class="token keyword">const</span> obj4 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> other <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj4<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'get obj'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> other
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">set</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'set obj'</span><span class="token punctuation">)</span>
    other <span class="token operator">=</span> val
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// set obj</span>
obj4<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'tom'</span><span class="token punctuation">;</span>
<span class="token comment">// get obj</span>
obj4<span class="token punctuation">.</span>name

<span class="token comment">/**
 * 使用get和set操作符
 */</span>
<span class="token keyword">const</span> obj5 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">other</span><span class="token operator">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'get obj1'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>other
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'set obj1'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>other <span class="token operator">=</span> val
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// set obj1</span>
obj5<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'tom'</span><span class="token punctuation">;</span>
<span class="token comment">// get obj1</span>
obj5<span class="token punctuation">.</span>name
</code></pre></div><h4 id="vue2响应式简陋实现"><a href="#vue2响应式简陋实现" class="header-anchor">#</a> vue2响应式简陋实现</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'allen'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
  <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">location</span><span class="token operator">:</span> <span class="token string">'深圳'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'触发修改'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 劫持数组的一些方法，去触发更新</span>
<span class="token keyword">const</span> methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'push'</span><span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span> <span class="token string">'splice'</span><span class="token punctuation">]</span>
methods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">method</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> oldFn <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>method<span class="token punctuation">]</span>
  <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">oldFn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 递归value，有可能是对象，需要递归</span>
  <span class="token function">observer</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>

  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> value
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">set</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">!==</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">observer</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
        <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        value <span class="token operator">=</span> val
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> obj <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> obj
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">observer</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</code></pre></div><h3 id="proxy"><a href="#proxy" class="header-anchor">#</a> proxy</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">defineProxy</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// set 返回设置结果</span>
    <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'update'</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

      <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对象</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'allen'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">arr</span><span class="token operator">:</span> <span class="token number">27</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> objectProxy <span class="token operator">=</span> <span class="token function">defineProxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

objectProxy<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'1'</span>

<span class="token comment">// 数组</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> arrProxy <span class="token operator">=</span> <span class="token function">defineProxy</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
<span class="token comment">// update 5 12</span>
<span class="token comment">// update length 6</span>
arrProxy<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>

<span class="token comment">// update length 10</span>
arrProxy<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">10</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/frame/react/dva.html" class="prev">
          手撕dva
        </a></span> <span class="next"><a href="/blog/frame/vue/my-vue2.html">
          手写vue2
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.80c9f677.js" defer></script><script src="/blog/assets/js/2.6d1c2cae.js" defer></script><script src="/blog/assets/js/60.10528cdc.js" defer></script>
  </body>
</html>
